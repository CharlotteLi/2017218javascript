<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>圆梦源：勿忘初心，方得始终</title>
    <style>
        body,html{
            height:200%;
        }
        p{
            position: absolute;
            top:1200px;
            width:300px;
            height:400px;
            background: url("img/default.gif") center #ccc no-repeat;
        }
        p img{
            width: 100%;
            height:100%;
        }
    </style>
</head>
<body>
<p><img src="" realImg="img/022222222.jpg" alt=""/></p>
<script src="utils.js"></script>
<script>
var oImg=document.getElementsByTagName('img')[0];
    window.onscroll=function(){
        var scrollBottom=utils.win('scrollTop')+utils.win('clientHeight');
        var imgPos=utils.offset(oImg).top+utils.getCss(oImg,'height');
        //判断图片是否满足显示的条件
        if(imgPos<scrollBottom){
            lazyImg();
        }
    };
    function lazyImg(){
        //避免重复加载
        if(oImg.loaded) return;
        //图片可以加载了；
        //先找一个临时的替身图片
        var tmpImg=new Image();//document.createElement('img');
        //替身图片来验证图片地址是否有效
        tmpImg.src=oImg.getAttribute('realImg');
        //图片地址正确，可以成功加载
        tmpImg.onload=function(){
            oImg.src=this.src;
            oImg.loaded=true;//避免重复加载
            tmpImg=null;//释放对象，提高性能；
        };
        tmpImg.onerror=function(){
            oImg.parentNode.style.backgroundImage='url("img/error.gif")';
            oImg.loaded=true;
            tmpImg=null;
        }
    }
</script>
</body>
</html>














